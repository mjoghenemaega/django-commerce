{% extends 'base.html' %}
{% load static %}
{% block link %}
<script src="https://unpkg.com/vuex@3.5.1/dist/vuex.js"></script>
<!-- JavaScript Bundle with Popper -->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>



  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

  <script src=  
"https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js">  
    </script>  
    
    <script src=  
"https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js">  
    </script>  
    
    <link href=  
"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/ui-lightness/jquery-ui.css"
        rel="stylesheet" type="text/css" />  

        
{% endblock %}

{% block content %}


<script>
  $( function() {
  var availableTags = [
    {% for product in products %}
      "{{product.title}}",
      
    {% endfor %}
  ];
  $( "#tags" ).autocomplete({
    source: "{% url 'autosuggest' %}",
    
  });
  });
</script>



     <!--
      - PRODUCT
    -->
    <div class="container">


    <nav class="breadcrumbs " style="width:100%; margin-top: 1rem; margin-bottom: 2rem; font-size: 0.8rem;"  >
      <a href="{% url 'frontpage' %}" class="breadcrumbs__item">Home</a>
      <a href="{% url 'frontpage' %}" class="breadcrumbs__item">Shop</a> 
      <a href="#" class="breadcrumbs__item is-active" >Cart</a>
     
    </nav>
  </div>
<div class="progress-track" >
  <ul id="progressbar" >
      <li class="step0 active " id="step1">Cart</li>
      <li class="step0  active text-center"  id="step2"></li>
      <li class="step0  text-right" id="step3">Checkout</li>
      <li class="step0 text-right" id="step4">payment</li>
  </ul>
</div>
    
<div class="product-container">

        <div class="container">
  
  
          <!--
            - SIDEBAR
          -->
          <div class="sidebar  has-scrollbar" data-mobile-menu>
  
            <div class="sidebar-category">
  
              <div class="sidebar-top">
                <h2 class="sidebar-title">Category</h2>
  
                <button class="sidebar-close-btn" data-mobile-menu-close-btn>
                  <ion-icon name="close-outline"></ion-icon>
                </button>
              </div>
  
              <ul class="sidebar-menu-category-list">
  
                <li class="sidebar-menu-category">
  
                  <button class="sidebar-accordion-menu" data-accordion-btn>
  
                    <div class="menu-title-flex">
                      <img src="{% static 'assets/images/icons/iphones.svg' %}" alt="Phones" width="20" height="20"
                        class="menu-title-img">
  
                      <p class="menu-title">Phones</p>
                    </div>
  
                    <div>
                      <ion-icon name="add-outline" class="add-icon"></ion-icon>
                      <ion-icon name="remove-outline" class="remove-icon"></ion-icon>
                    </div>
  
                  </button>
  
                  <ul class="sidebar-submenu-category-list" data-accordion>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Samsung</p>
                        <data value="300" class="stock" title="Available Stock">300</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Htc</p>
                        <data value="60" class="stock" title="Available Stock">60</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Techno</p>
                        <data value="50" class="stock" title="Available Stock">50</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">xiaomi</p>
                        <data value="87" class="stock" title="Available Stock">87</data>
                      </a>
                    </li>
  
                  </ul>
  
                </li>
  
                <li class="sidebar-menu-category">
  
                  <button class="sidebar-accordion-menu" data-accordion-btn>
  
                    <div class="menu-title-flex">
                      <img src="{% static 'assets/images/icons/laptop.svg' %}" alt="laptop" class="menu-title-img" width="20"
                        height="20">
  
                      <p class="menu-title">Laptops</p>
                    </div>
  
                    <div>
                      <ion-icon name="add-outline" class="add-icon"></ion-icon>
                      <ion-icon name="remove-outline" class="remove-icon"></ion-icon>
                    </div>
  
                  </button>
  
                  <ul class="sidebar-submenu-category-list" data-accordion>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Apple</p>
                        <data value="45" class="stock" title="Available Stock">45</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Hp</p>
                        <data value="75" class="stock" title="Available Stock">75</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Alienware</p>
                        <data value="35" class="stock" title="Available Stock">35</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">LG</p>
                        <data value="26" class="stock" title="Available Stock">26</data>
                      </a>
                    </li>
  
                  </ul>
  
                </li>
  
                <li class="sidebar-menu-category">
  
                  <button class="sidebar-accordion-menu" data-accordion-btn>
  
                    <div class="menu-title-flex">
                      <img src="{% static 'assets/images/icons/gamepad.svg' %}" alt="gamepad" class="menu-title-img" width="20"
                        height="20">
  
                      <p class="menu-title">Accessories</p>
                    </div>
  
                    <div>
                      <ion-icon name="add-outline" class="add-icon"></ion-icon>
                      <ion-icon name="remove-outline" class="remove-icon"></ion-icon>
                    </div>
  
                  </button>
  
                  <ul class="sidebar-submenu-category-list" data-accordion>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Earphones</p>
                        <data value="46" class="stock" title="Available Stock">46</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Screen</p>
                        <data value="73" class="stock" title="Available Stock">73</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Ports</p>
                        <data value="61" class="stock" title="Available Stock">61</data>
                      </a>
                    </li>
  
                  </ul>
  
                </li>
  
                <li class="sidebar-menu-category">
  
                  <button class="sidebar-accordion-menu" data-accordion-btn>
  
                    <div class="menu-title-flex">
                      <img src="{% static 'assets/images/icons/drone.svg' %}" alt="drones" class="menu-title-img" width="20"
                        height="20">
  
                      <p class="menu-title">Drones</p>
                    </div>
  
                    <div>
                      <ion-icon name="add-outline" class="add-icon"></ion-icon>
                      <ion-icon name="remove-outline" class="remove-icon"></ion-icon>
                    </div>
  
                  </button>
  
                  <ul class="sidebar-submenu-category-list" data-accordion>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Mavic</p>
                        <data value="12" class="stock" title="Available Stock">12 pcs</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Espcopter</p>
                        <data value="60" class="stock" title="Available Stock">60 pcs</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Hp</p>
                        <data value="50" class="stock" title="Available Stock">50 pcs</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Tools</p>
                        <data value="87" class="stock" title="Available Stock">87 pcs</data>
                      </a>
                    </li>
  
                  </ul>
  
                </li>
  
                <li class="sidebar-menu-category">
  
                  <button class="sidebar-accordion-menu" data-accordion-btn>
  
                    <div class="menu-title-flex">
                      <img src="{% static 'assets/images/icons/tools.svg' %}" alt="tools" class="menu-title-img" width="20"
                        height="20">
  
                      <p class="menu-title">Tools</p>
                    </div>
  
                    <div>
                      <ion-icon name="add-outline" class="add-icon"></ion-icon>
                      <ion-icon name="remove-outline" class="remove-icon"></ion-icon>
                    </div>
  
                  </button>
  
                  <ul class="sidebar-submenu-category-list" data-accordion>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">pin</p>
                        <data value="68" class="stock" title="Available Stock">68</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">solder</p>
                        <data value="46" class="stock" title="Available Stock">46</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">charger</p>
                        <data value="23" class="stock" title="Available Stock">23</data>
                      </a>
                    </li>
  
                  </ul>
  
                </li>
  
                <li class="sidebar-menu-category">
  
                  <button class="sidebar-accordion-menu" data-accordion-btn>
  
                    <div class="menu-title-flex">
                      <img src="{% static 'assets/images/icons/gameconsole.svg' %}" alt="gameconsole" class="menu-title-img" width="20"
                        height="20">
  
                      <p class="menu-title">Game consoles </p>
                    </div>
  
                    <div>
                      <ion-icon name="add-outline" class="add-icon"></ion-icon>
                      <ion-icon name="remove-outline" class="remove-icon"></ion-icon>
                    </div>
  
                  </button>
  
                  <ul class="sidebar-submenu-category-list" data-accordion>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Playstation</p>
                        <data value="50" class="stock" title="Available Stock">50</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Heroku</p>
                        <data value="48" class="stock" title="Available Stock">48</data>
                      </a>
                    </li>
  
                  </ul>
  
                </li>
  
                <li class="sidebar-menu-category">
  
                  <button class="sidebar-accordion-menu" data-accordion-btn>
  
                    <div class="menu-title-flex">
                      <img src="{% static 'assets/images/icons/console.svg' %}" alt="console" class="menu-title-img" width="20" height="20">
  
                      <p class="menu-title">consoles</p>
                    </div>
  
                    <div>
                      <ion-icon name="add-outline" class="add-icon"></ion-icon>
                      <ion-icon name="remove-outline" class="remove-icon"></ion-icon>
                    </div>
  
                  </button>
  
                  <ul class="sidebar-submenu-category-list" data-accordion>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">Hardrives</p>
                        <data value="62" class="stock" title="Available Stock">62</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">RAM</p>
                        <data value="35" class="stock" title="Available Stock">35</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">flashdrive</p>
                        <data value="80" class="stock" title="Available Stock">80</data>
                      </a>
                    </li>
  
                    <li class="sidebar-submenu-category">
                      <a href="#" class="sidebar-submenu-title">
                        <p class="product-name">memorycards</p>
                        <data value="75" class="stock" title="Available Stock">75</data>
                      </a>
                    </li>
  
                  </ul>
  
                </li>
  
              </ul>
  
            </div>
  
        
          </div>
          
        
  



 
 <div class="item-flex" id="cartapp">
  {% if cart %}



<section class="checkout" v-if="products.length > 0" >


  
  <div class="wrapper">

    <div class="discount-token">

      <label for="discount-token" class="label-default">Gift card/Discount code</label>

      <div class="wrapper-flex">

        <input type="text" name="discount-token" id="discount-token" class="input-default">

        <button class="btn btn-outline">Apply</button>

      </div>

    </div>

    <div class="amount">

      <div class="subtotal">
        <span>Subtotal</span> <span>$ <span id="subtotal">  [[ totalCost ]]</span></span>
      </div>

      

      <div class="shipping">
        <span>Shipping</span> <span>$ <span id="shipping">500.00</span></span>
      </div>

      <div class="total">
        <span>Total</span> <span>$ <span id="total">[[ totalCost + 500 ]]</span></span>
      </div>

    </div>


  </div>
  <div class="container"> <a href="{% url 'checkout' %}" style="color: #FFF;"><button class="btn btn-primary" style="background-color:#ff5f3b">
    <b>Checkout</b>$([[  totalshipCost ]])
  </button></a></div>
    


  

</section>




<!--
  - cart section
-->
<section class="cart"   v-if="products.length > 0">
  <div class="cart-item-box">

    <h2 class="section-heading">Cart items([[ numItems]])</h2>

    <div class="product-card" >

      <div class="card" v-for="product in products">

        <div class="img-box">
          <img :src="product.thumbnail"  width="80px" class="product-img">
        </div>

        <div class="detail">

          <h4 class="product-name"><a :href="product.url">
            [[ product.title ]]
        </a></h4>

          <div class="wrapper">

            <div class="product-qty">
              <button @click="decrementQuantity(product.id, product.quantity, product.price)">
                <ion-icon name="remove-outline"></ion-icon>
              </button>

              <span id="quantity">[[ product.quantity ]]</span>

              <button  @click="incrementQuantity(product.id, product.quantity, product.price)">
                <ion-icon name="add-outline"></ion-icon>
              </button>
            </div>

            <div class="price">
              $<span id="price">[[ product.total_price ]]</span>
            </div>

          </div>

        </div>

        <button class="product-close-btn" @click="removeFromCart(product.id)">
          <ion-icon name="close-outline" id="b3" ></ion-icon>
        </button>

      </div>

    </div>



  </div>

</section>



{% else %}
 <div class="container">
<div style="text-align: center; margin-top: 2rem;"><h4>Oops, Your Cart is empty!</h4><br>
  <a href="{% url 'frontpage' %}" style="color: #FFF;"><button class="btn btn-primary" style="background-color: #ff5f3b">
    <b>Lets Go</b>Shopping!
  </button></a></div>


</div>
{% endif %}


</div>
          </div>
  </div>
  <style>/*-----------------------------------*\
    #style.css
  \*-----------------------------------*/
  
  
  
  
  
  
  
  /*-----------------------------------*\
    #VARIABLE
  \*-----------------------------------*/
  
  :root {
  
    /**
     * Colors
     */
  
    --onyx:         hsl(0, 0%, 25%);
    --azure:        hsl(219, 77%, 60%);
    --white:        hsl(0, 0%, 100%);
    --platinum:     hsl(0, 0%, 91%);
    --gainsboro:    hsl(0, 0%, 90%);
    --red-salsa:    hsl(0, 77%, 60%);
    --dim-gray:     hsl(0, 0%, 39%);
    --davys-gray:   hsl(0, 0%, 30%);
    --spanish-gray: hsl(0, 0%, 62%);
    --quick-silver: hsl(0, 0%, 64%);
  
    /**
     * Typography
     */
  
    --fs-28: 28px;
    --fs-24: 24px;
    --fs-18: 18px;
    --fs-15: 15px;
    --fs-14: 14px;
  
    --fw-5: 500;
    --fw-6: 600;
    --fw-7: 700;
  
    /**
     * Others 
     */
  
    --px: 60px;
    --radius: 5px;
  
  }
  
  
  
  
  
  /*-----------------------------------*\
    #RESET
  \*-----------------------------------*/
  
  ion-icon { display: inline-block; }
  
  
  
  
  /*-----------------------------------*\
    #MAIN STYLE
  \*-----------------------------------*/
  
  /**
   * main container 
   */
   label, img { display: block; }




  .item-flex {
    display: flex;
    flex-grow: 1;
  }
  
  /**
   * checkout section style 
   */
  
 
.checkout {
  width: 70%;
  padding: 40px var(--px);
  background: var(--white);
  border-right: 1px solid var(--gainsboro);
}

  
  .section-heading {
    color: var(--onyx);
    margin-bottom: 30px;
    font-size: var(--fs-24);
    font-weight: var(--fw-5);
  }
  
  .payment-form { margin-bottom: 40px; }
  
  .payment-method {
    display:     flex;
    align-items: center;
    gap: 30px;
    margin-bottom: 40px;
  }
  
  .payment-method .method {
    border: 1px solid var(--quick-silver);
    border-radius: var(--radius);
    width: 50%;
    display:     flex;
    align-items: center;
    padding: 15px 30px;
    gap: 20px;
    cursor: pointer;
  }
  
  .payment-method .selected { border-color: var(--azure); }
  
  .payment-method .method ion-icon { font-size: 20px; }
  
  .payment-method .method .checkmark {
    margin-left: auto;
    color: var(--quick-silver);
  }
  
  .payment-method .method .fill { color: var(--azure); }
  
  .label-default {
    padding-left: 10px;
    margin-bottom: 5px;
    font-size: var(--fs-14);
    color: var(--spanish-gray);
  }
  
  .input-default {
    background: var(--platinum);
    border-radius: var(--radius);
    color: var(--davys-gray);
  }
  
  .payment-form input {
    padding: 10px 15px;
    font-size: var(--fs-18);
    font-weight: var(--fw-5);
  }
  
  .cardholder-name,
  .card-number { margin-bottom: 20px; }
  
  .card-number input,
  .cvv input { letter-spacing: 3px; }
  
  .input-flex {
    display:     flex;
    align-items: center;
    gap: 30px;
  }
  
  .input-flex .expire-date,
  .input-flex .cvv { width: 50%; }
  
  .expire-date .input-flex {
    color: var(--spanish-gray);
    gap: 13px;
  }
  
  .expire-date .input-flex input { text-align: center; }
  
  .btn { border-radius: var(--radius); }
  
  .btn:active { transform: scale(0.99); }
  
  .btn:focus {
    color: var(--white);
    background: var(--azure);
    outline: 2px solid var(--azure);
    outline-offset: 2px;
  }
  
  .btn-primary {
    background: #ff5f3b;
    font-weight: var(--fw-5);
    color: var(--white);
    padding: 13px 45px;
  }
  
  .btn-primary b { margin-right: 10px; }
  
  
  /**
   * cart section style
   */
  
  .cart {
    width: 50%;
    display:         flex;
    flex-direction:  column;
    justify-content: flex-end;
  }
  
  .cart-item-box {
    padding: 40px var(--px);
    margin-bottom: auto;
  }
  
  .product-card:not(:last-child) { margin-bottom: 20px; }
  
  .product-card .card {
    position: relative;
    display:     flex;
    align-items: flex-start;
    gap: 20px;
  }
  
  .card .product-img { border-radius: var(--radius); }
  
  .card .detail .product-name {
    font-weight: var(--fw-6);
    font-size: var(--fs-15);
    color: var(--dim-gray);
    margin-bottom: 10px;
  }
  
  .card .detail .wrapper {
    display: flex;
    gap: 20px;
  }
  
  .product-qty {
    display:     flex;
    align-items: center;
    gap: 10px;
  }
  
  .product-qty button {
    background: #ff5f3b;
    width:  20px;
    height: 20px;
    display:         flex;
    justify-content: center;
    align-items:     center;
  }
  
  .product-qty button:active,
  .product-close-btn:active ion-icon { transform: scale(0.95); }
  
  .product-qty button ion-icon {
    --ionicon-stroke-width: 60px;
    color: black;
    font-size: 10px;
  }
  
  .product-close-btn {
    position: absolute;
    top:   0;
    right: 0;
  }
  
  .product-close-btn ion-icon {
    font-size: 25px;
    color: #f68b1E;
  }
  
  .product-close-btn:hover ion-icon { color: var(--red-salsa); }
  
  .discount-token {
    padding: 40px var(--px);
    border-top:    1px solid var(--gainsboro);
    border-bottom: 1px solid var(--gainsboro);
  }
  
  .wrapper-flex {
    display:     flex;
    align-items: center;
    gap: 30px;
  }
  
  .wrapper-flex input {
    padding: 12px 15px;
    font-weight: var(--fw-6);
    letter-spacing: 2px;
  }
  
  .btn-outline {
    padding: 10px 25px;
    border: 1px solid var(--azure);
    color: var(--azure);
  }
  
  .btn-outline:hover {
    background: var(--azure);
    color: var(--white);
  }
  
  .amount { padding: 40px var(--px); }
  
  .amount > div {
    display:         flex;
    justify-content: space-between;
  }
  
  .amount > div:not(:last-child) { margin-bottom: 10px; }
  
  .amount .total {
    font-size: var(--fs-18);
    font-weight: var(--fw-7);
    color: var(--onyx);
  }
  
  
  
  
  
  /*-----------------------------------*\
    #RESPONSIVE
  \*-----------------------------------*/
  
  @media (max-width: 1200px) {
  
    .item-flex { flex-direction: column-reverse; }
  
    /**
     * checkout section responsive 
     */
  
    .checkout {
      width: 100%;
      border-right: none;
    }
  
    .btn-primary { width: 100%; }
  
    /**
     * cart section responsive
     */
  
    .cart {
      display: grid;
      grid-template-columns: 1fr 1fr;
      width: 100%;
      border-bottom: 1px solid var(--gainsboro);
    }
  
    .cart .wrapper { margin-top: auto; }
  
    .cart .cart-item-box {
      border-right: 1px solid var(--gainsboro);
      margin-bottom: 0;
    }
  
    .discount-token { border-top: none; }
  
  }
  
  
  
  
  
  @media (max-width: 768px) {
  
    :root { --px: 40px; }
  
    .cart { grid-template-columns: 1fr; }
  
    .discount-token { border-top: 1px solid var(--gainsboro); }
  
    .wrapper-flex { gap: 20px; }
  
  }
  
  
  
  
  
  @media (max-width: 567px) {
  
    :root { --px: 20px; }
  
    .payment-method,
    .input-flex {
      flex-direction: column;
      gap: 20px;
    }
  
    .payment-method .method { width: 100%; }
  
    .input-flex .expire-date,
    .input-flex .cvv { width: 100%; }
  
    .expire-date .input-flex { flex-direction: row; }
  
  }</style>
  
 {% endblock %}

{% block scripts %}
<script>
    var productapp = new Vue({
        el: '#cartapp',
        delimiters: ['[[', ']]'],
        store: store,
        data () {
            return {
                errors: [],
                first_name: '{{ first_name }}',
                last_name: '{{ last_name }}',
                email: '{{ email }}',
                address: '{{ address }}',
                zipcode: '{{ zipcode }}',
                place: '{{ place }}',
                phone: '{{ phone }}',
                products: [{{ productsstring|safe }}],
                coupon_value: 0,
                coupon_code: '',
                showCouponCodeError: false
            }
        },
        mounted() {
            const amount = this.totalCostWithCoupon.toString();

            paypal.Buttons({
                onClick: () => {
                    if (this.validateForm() > 0) {
                        return false;
                    }
                },
                createOrder: function(data, actions) {
                    return actions.order.create({
                        purchase_units: [{
                            amount: {
                                value: amount
                            }
                        }]
                    })
                },
                onApprove: (data, actions) => {
                    const formdata = {
                        'first_name': this.first_name,
                        'last_name': this.last_name,
                        'email': this.email,
                        'address': this.address,
                        'zipcode': this.zipcode,
                        'place': this.place,
                        'phone': this.phone,
                        'coupon_code': this.coupon_code,
                        'gateway': 'paypal',
                        'order_id': data.orderID
                    };

                    return actions.order.capture().then(function(details) {
                        fetch('/api/create_checkout_session/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                            credentials: 'same-origin',
                            body: JSON.stringify(formdata)
                        })
                        .then(function(response) {
                            return response.json()
                        })
                        .then(function(result) {
                            window.location.href = '/cart/success/';
                        })
                        .catch(function(error) {
                            console.log('error:', error);
                        });
                    });
                }
            }).render('#paypal-button-container');
        },
        computed: {
            numItems: function() {
                return store.state.numItems
            },
            totalCost: function() {
                return store.state.totalCost
            },
            totalshipCost: function() {
                return store.state.totalCost +(500)
            },
            totalCostWithCoupon: function() {
                if (this.coupon_value > 0) {
                    return store.state.totalCost * (parseInt(this.coupon_value) / 100);
                } else {
                    return store.state.totalCost;
                }
            }
        },
        methods: {
            validateForm() {
                this.errors = [];

                if (this.first_name === '') {
                    this.errors.push('First name is empty');
                }

                if (this.last_name === '') {
                    this.errors.push('Last name is empty');
                }

                if (this.email === '') {
                    this.errors.push('Email is empty');
                }

                if (this.address === '') {
                    this.errors.push('Address is empty');
                }

                if (this.zipcode === '') {
                    this.errors.push('Zip code is empty');
                }

                if (this.place === '') {
                    this.errors.push('Place is empty');
                }

                if (this.phone === '') {
                    this.errors.push('Phone is empty');
                }

                return this.errors.length;
            },
            applyCoupon() {
                if (this.coupon_code !== '') {
                    fetch('/api/can_use/?coupon_code=' + this.coupon_code, {
                        method: 'GET'
                    })
                    .then((response) => {
                        return response.json();
                    })
                    .then((data) => {
                        if (data.amount) {
                            this.showCouponCodeError = false
                            this.coupon_value = parseInt(data.amount)
                        } else {
                            this.coupon_value = 0
                            this.showCouponCodeError = true
                        }
                    });
                } else {
                    this.showCouponCodeError = true
                }
            },
            buy(gateway) {
                var data = {
                    'first_name': this.first_name,
                    'last_name': this.last_name,
                    'email': this.email,
                    'address': this.address,
                    'zipcode': this.zipcode,
                    'place': this.place,
                    'phone': this.phone,
                    'coupon_code': this.coupon_code,
                    'gateway': gateway
                };

                if (this.validateForm() === 0) {
                    if (gateway === 'stripe') {
                        var stripe = Stripe('{{ pub_key }}');

                        fetch('/api/create_checkout_session/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                            credentials: 'same-origin',
                            body: JSON.stringify(data)
                        })
                        .then(function(response) {
                            return response.json()
                        })
                        .then(function(session) {
                            return stripe.redirectToCheckout({ sessionId: session.session.id })
                        })
                        .then(function(result) {
                            if (result.error) {
                                alert(result.error.message)
                            }
                        })
                        .catch(function(error) {
                            console.log('Error:', error);
                        });
                    } else if (gateway === 'razorpay') {
                        fetch('/api/create_checkout_session/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': '{{ csrf_token }}'
                            },
                            credentials: 'same-origin',
                            body: JSON.stringify(data)
                        })
                        .then(function(response) {
                            return response.json()
                        })
                        .then(function(result) {
                            const order_id = result.order.id;
                            const amount = result.order.amount;

                            var options = {
                                'key': '{{ pub_key_razorpay }}',
                                'amount': amount,
                                'currency': 'INR',
                                'name': 'Saul Gadgets',
                                'description': 'A cool gadget store',
                                'order_id': order_id,
                                'handler': function(res) {
                                    console.log('Handler');
                                    
                                    fetch('/api/validate_payment/', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'X-CSRFToken': '{{ csrf_token }}'
                                        },
                                        credentials: 'same-origin',
                                        body: JSON.stringify({
                                            'razorpay_payment_id': res.razorpay_payment_id,
                                            'razorpay_order_id': res.razorpay_order_id,
                                            'razorpay_signature': res.razorpay_signature
                                        })
                                    })
                                    .then(function(response) {
                                        return response.json();
                                    })
                                    .then(function(result) {
                                        window.location.href = '/cart/success/';
                                    })
                                    .catch(function(error) {
                                        console.log('Error:', error);
                                    });
                                },
                                'prefill': {
                                    'name': data.first_name + ' ' + data.last_name,
                                    'email': data.email,
                                    'contact': data.phone
                                },
                                'theme': {
                                    'color': '#333333'
                                }
                            };

                            var rzp = new Razorpay(options);
                            rzp.open();
                        })
                        .catch(function(error) {
                            console.log('Error', error);
                        });
                    }
                }
            },
            incrementQuantity(product_id, quantity, price) {
                console.log('Product_id:', product_id);

                for (var i = 0; i < this.products.length; i++) {
                    var product = this.products[i];

                    if (product.id === product_id) {
                        if (quantity < product.num_available) {
                            var data = {
                                'product_id': product_id, 
                                'update': true,
                                'quantity': parseInt(quantity) + 1
                            };

                            store.commit('increment', 1);
                            store.commit('changeTotalCost', parseFloat(price));
                                
                            fetch('/api/add_to_cart/', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': '{{ csrf_token }}'
                                },
                                credentials: 'same-origin',
                                body: JSON.stringify(data)
                            })
                            .then((response) => {
                                console.log(response)

                                for (var i = 0; i < this.products.length; i++) {
                                    var product = this.products[i];
            
                                    if (product.id === product_id) {
                                        this.products[i].quantity = parseInt(this.products[i].quantity) + 1;
                                        this.products[i].total_price = parseInt(this.products[i].quantity) * parseFloat(this.products[i].price)
                                    }
                                }
                            })
                            .catch(function (error) {
                                console.log('Error 2');
                                console.log(error);
                            })
                        } else {
                          swal("Oh no!", "This product is out of stock!", "warning");
                        }
                    } 
                }
            },
            decrementQuantity(product_id, quantity, price) {
                console.log('Product_id:', product_id);

                var data = {
                    'product_id': product_id, 
                    'update': true,
                    'quantity': parseInt(quantity) - 1
                };
                    
                if (parseInt(quantity) - 1 === 0) {
                    this.removeFromCart(product_id);
                } else {
                    store.commit('increment', -1);
                    store.commit('changeTotalCost', -parseFloat(price));
                 
                    fetch('/api/add_to_cart/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        credentials: 'same-origin',
                        body: JSON.stringify(data)
                    })
                    .then((response) => {
                        console.log(response)

                        for (var i = 0; i < this.products.length; i++) {
                            var product = this.products[i];
    
                            if (product.id === product_id) {
                                this.products[i].quantity = parseInt(this.products[i].quantity) - 1;
                                this.products[i].total_price = parseInt(this.products[i].quantity) * parseFloat(this.products[i].price)
                            }
                        }
                    })
                    .catch(function (error) {
                        console.log('Error 2');
                        console.log(error);
                    })
                }
            },
            removeFromCart(product_id) {
                console.log('Remove product_id:', product_id);

                var data = {
                    'product_id': product_id
                };
                    
                fetch('/api/remove_from_cart/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify(data)
                })
                .then((response) => {
                    console.log(response)

                    this.products = this.products.filter(product => product.id !== product_id)
                    window.location.href = '/cart/';
                })
                .catch(function (error) {
                    console.log('Error 2');
                    console.log(error);
                })
            }
        }
    });
</script> 
<script>
                                        
    document.getElementById('b3').onclick = function(){
      
        swal("Oh no!", "This product has been removed!", "success");
        
        

    };
   
 </script>
{% endblock %}


